{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/blockchain_project/src/components/Roaster/Roaster/Roasting/AddRoasting.js\",\n    _s = $RefreshSig$();\n\nimport { Fragment, useState, useEffect } from \"react\";\nimport AddRoastingForm from \"./AddRoastingForm\";\nimport showResults from \"../../../showResults/showResults\";\nimport UserService from \"../../../../services/user.service\";\nimport QRcode from \"qrcode.react\";\nimport { sha256 } from \"js-sha256\";\nimport Web3 from \"web3\";\nimport { AddProduct } from \"../../../../abi/abi\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nrequire(\"dotenv\").config();\n\nconst HDWalletProvider = require(\"@truffle/hdwallet-provider\");\n\nconst AddRoasting = props => {\n  _s();\n\n  const provider = new HDWalletProvider(process.env.REACT_APP_MNEMONIC, \"https://ropsten.infura.io/v3/\" + process.env.REACT_APP_INFURA_PROJECT_ID);\n  const web3 = new Web3(provider);\n  provider.engine.stop();\n  const contractAddress = \"0x061Bca64852219aA03a9615ef66Dc301e075F6d9\";\n  const code = props.code;\n  const [qr, setQr] = useState(\"test\");\n  const [roastingFile, setRoastingFile] = useState(\"\");\n  const [filesGambar, imageFileGambar] = useState(\"\");\n  const [account, setAccount] = useState(\"\");\n\n  const getWallet = async () => {\n    web3.eth.getAccounts(function (err, accounts) {\n      if (err != null) {\n        alert(\"An error occurred: \" + err);\n      } else if (accounts.length == 0) {\n        alert(\"User is not logged in to MetaMask\");\n      } else {\n        setAccount(accounts[0]);\n      }\n    });\n  };\n\n  const handleChange = value => {\n    setQr(value);\n  };\n\n  const onFileChangeGambar = file => {\n    imageFileGambar(file);\n  };\n\n  const downloadQR = roasting_id => {\n    const canvas = document.getElementById(\"myqr\");\n    const pngUrl = canvas.toDataURL(\"image/png\").replace(\"image/png\", \"image/octet-stream\");\n    let downloadLink = document.createElement(\"a\");\n    downloadLink.href = pngUrl;\n    downloadLink.download = \"\" + roasting_id + \".png\";\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n  };\n\n  const onRoastingChange = file => {\n    setRoastingFile(file);\n  };\n\n  useEffect(() => {\n    getWallet();\n  }, []);\n\n  const handleSubmit = async values => {\n    if (values.roastingMenu && values.roastingProfile && values.roastingName && values.flavorNote && values.acidity && values.intensity && values.weight && certificateFile != \"\" && filesGambar != \"\") {\n      // console.log(process.env.REACT_APP_MNEMONIC);\n      // console.log(\"https://ropsten.infura.io/v3/\" + process.env.REACT_APP_INFURA_PROJECT_ID);\n      const formData = new FormData();\n\n      if (values.roastingMenu == \"Single\") {\n        formData.append(\"bean_id\", values.bean);\n      }\n\n      if (values.roastingMenu == \"Blended\") {\n        formData.append(\"beans\", JSON.stringify(values.beans));\n      }\n\n      formData.append(\"roasting_profile_id\", values.roastingProfile);\n      formData.append(\"roasting_name\", values.roastingName);\n      formData.append(\"roastingMenu\", values.roastingMenu);\n      formData.append(\"flavor_note\", values.flavorNote);\n      formData.append(\"acidity\", values.acidity);\n      formData.append(\"intensity\", values.intensity);\n      formData.append(\"weight\", values.weight);\n      formData.append(\"tgl_roasting\", values.tgl_roasting);\n\n      for (let i = 0; i < certificateFile.length; i++) {\n        formData.append(\"certificate[]\", certificateFile[i]);\n      }\n\n      formData.append(\"files_gambar\", filesGambar);\n      formData.append(\"fileName_gambar\", filesGambar.name);\n      UserService.addRoastingProduct(formData).then(async response => {\n        const roasting_id = response.data.roasting.id;\n        const linkQRCode = process.env.REACT_APP_ROASTER_URL + \"detailRoasting/\" + code + \"/\" + roasting_id;\n        await handleChange(linkQRCode);\n        const canvas = document.getElementById(\"myqr\");\n        let imageBlob = await new Promise(resolve => canvas.toBlob(resolve, \"image/png\"));\n        let formDataQR = new FormData();\n        formDataQR.append(\"files_qr\", imageBlob, \"\" + roasting_id + \".png\");\n        formDataQR.append(\"fileName_qr\", \"\" + roasting_id + \".png\");\n        downloadQR(roasting_id);\n        UserService.pushQRCodeImageRoasting(roasting_id, formDataQR);\n        UserService.getDetailRoastingProduct(roasting_id).then(async response => {\n          console.log(response.data);\n          var object = response.data; // formData.forEach(function (value, key) {\n          //   object[key] = value;\n          // });\n\n          var json = JSON.stringify(object); // console.log(json);\n\n          console.log(sha256(json)); // console.log(contractAddress);\n\n          console.log(account);\n          let date_ob = new Date();\n          let date = (\"0\" + date_ob.getDate()).slice(-2);\n          let month = (\"0\" + (date_ob.getMonth() + 1)).slice(-2);\n          let year = date_ob.getFullYear();\n          let hours = date_ob.getHours();\n          let minutes = date_ob.getMinutes();\n          let seconds = date_ob.getSeconds();\n          console.log(year + \"-\" + month + \"-\" + date); //Blockchain Function\n\n          const storageContract = new web3.eth.Contract(AddProduct, contractAddress); // const gas = await storageContract.methods\n          // .tambahProduct(\n          //   sha256(json),\n          //   year + \"-\" + month + \"-\" + date\n          // )\n          // .estimateGas();\n\n          var post = await storageContract.methods.tambahProduct(sha256(json), year + \"-\" + month + \"-\" + date).send({\n            from: account // gas,\n\n          }, (error, transactionHash) => {\n            console.log(transactionHash);\n          });\n          console.log(post); //Postman Kopi Ketjil\n\n          var myHeaders = new Headers();\n          myHeaders.append(\"x-api-key\", \"kk-blockchain-2021-dev\");\n          var formdata = new FormData();\n          formdata.append(\"category_id\", \"115\");\n          formdata.append(\"name\", values.roastingName);\n          formdata.append(\"description\", json);\n          formdata.append(\"indonesia_price\", \"1000\");\n          formdata.append(\"usd_price\", \"10\");\n          formdata.append(\"aed_price\", \"50\");\n          formdata.append(\"image[]\", filesGambar, \"[PROXY]\");\n          var requestOptions = {\n            method: \"POST\",\n            headers: myHeaders,\n            body: formdata,\n            redirect: \"follow\"\n          };\n          fetch(\"https://api-staging.kopiketjil.com/api/kopiketjil/insert-product\", requestOptions).then(response => response.text()).then(result => console.log(result)).catch(error => console.log(\"error\", error));\n        });\n      });\n      showResults(\"Data has been added\");\n    } else {\n      showResults(\"Please fill all the fields\");\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(AddRoastingForm, {\n      onSubmit: handleSubmit,\n      onSelectRoasting: onRoastingChange,\n      onSelectImageGambar: onFileChangeGambar\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        visibility: \"hidden\"\n      },\n      children: qr ? /*#__PURE__*/_jsxDEV(QRcode, {\n        id: \"myqr\",\n        value: qr,\n        size: 320,\n        includeMargin: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"No QR code preview\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 218,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AddRoasting, \"x6frOb4+lsfuj52rCUpQW4B9qYk=\");\n\n_c = AddRoasting;\nexport default AddRoasting;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddRoasting\");","map":{"version":3,"sources":["/Applications/MAMP/htdocs/blockchain_project/src/components/Roaster/Roaster/Roasting/AddRoasting.js"],"names":["Fragment","useState","useEffect","AddRoastingForm","showResults","UserService","QRcode","sha256","Web3","AddProduct","require","config","HDWalletProvider","AddRoasting","props","provider","process","env","REACT_APP_MNEMONIC","REACT_APP_INFURA_PROJECT_ID","web3","engine","stop","contractAddress","code","qr","setQr","roastingFile","setRoastingFile","filesGambar","imageFileGambar","account","setAccount","getWallet","eth","getAccounts","err","accounts","alert","length","handleChange","value","onFileChangeGambar","file","downloadQR","roasting_id","canvas","document","getElementById","pngUrl","toDataURL","replace","downloadLink","createElement","href","download","body","appendChild","click","removeChild","onRoastingChange","handleSubmit","values","roastingMenu","roastingProfile","roastingName","flavorNote","acidity","intensity","weight","certificateFile","formData","FormData","append","bean","JSON","stringify","beans","tgl_roasting","i","name","addRoastingProduct","then","response","data","roasting","id","linkQRCode","REACT_APP_ROASTER_URL","imageBlob","Promise","resolve","toBlob","formDataQR","pushQRCodeImageRoasting","getDetailRoastingProduct","console","log","object","json","date_ob","Date","date","getDate","slice","month","getMonth","year","getFullYear","hours","getHours","minutes","getMinutes","seconds","getSeconds","storageContract","Contract","post","methods","tambahProduct","send","from","error","transactionHash","myHeaders","Headers","formdata","requestOptions","method","headers","redirect","fetch","text","result","catch","visibility"],"mappings":"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","sourcesContent":["import { Fragment, useState, useEffect } from \"react\";\nimport AddRoastingForm from \"./AddRoastingForm\";\nimport showResults from \"../../../showResults/showResults\";\nimport UserService from \"../../../../services/user.service\";\nimport QRcode from \"qrcode.react\";\nimport { sha256 } from \"js-sha256\";\nimport Web3 from \"web3\";\nimport { AddProduct } from \"../../../../abi/abi\";\n\nrequire(\"dotenv\").config();\n\nconst HDWalletProvider = require(\"@truffle/hdwallet-provider\");\n\nconst AddRoasting = (props) => {\n  const provider = new HDWalletProvider(\n    process.env.REACT_APP_MNEMONIC,\n    \"https://ropsten.infura.io/v3/\" + process.env.REACT_APP_INFURA_PROJECT_ID\n  );\n  const web3 = new Web3(provider);\n  provider.engine.stop()\n  const contractAddress = \"0x061Bca64852219aA03a9615ef66Dc301e075F6d9\";\n\n  const code = props.code;\n  const [qr, setQr] = useState(\"test\");\n  const [roastingFile, setRoastingFile] = useState(\"\");\n  const [filesGambar, imageFileGambar] = useState(\"\");\n  const [account, setAccount] = useState(\"\");\n\n  const getWallet = async () => {\n    web3.eth.getAccounts(function (err, accounts) {\n      if (err != null) {\n        alert(\"An error occurred: \" + err);\n      } else if (accounts.length == 0) {\n        alert(\"User is not logged in to MetaMask\");\n      } else {\n        setAccount(accounts[0]);\n      }\n    });\n  };\n\n  const handleChange = (value) => {\n    setQr(value);\n  };\n\n  const onFileChangeGambar = (file) => {\n    imageFileGambar(file);\n  };\n\n  const downloadQR = (roasting_id) => {\n    const canvas = document.getElementById(\"myqr\");\n    const pngUrl = canvas\n      .toDataURL(\"image/png\")\n      .replace(\"image/png\", \"image/octet-stream\");\n    let downloadLink = document.createElement(\"a\");\n    downloadLink.href = pngUrl;\n    downloadLink.download = \"\" + roasting_id + \".png\";\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n  };\n\n  const onRoastingChange = (file) => {\n    setRoastingFile(file);\n  };\n\n  useEffect(() => {\n    getWallet();\n  }, []);\n\n  const handleSubmit = async (values) => {\n    if (\n      values.roastingMenu &&\n      values.roastingProfile &&\n      values.roastingName &&\n      values.flavorNote &&\n      values.acidity &&\n      values.intensity &&\n      values.weight &&\n      certificateFile != \"\" &&\n      filesGambar != \"\"\n    ) {\n      // console.log(process.env.REACT_APP_MNEMONIC);\n      // console.log(\"https://ropsten.infura.io/v3/\" + process.env.REACT_APP_INFURA_PROJECT_ID);\n      const formData = new FormData();\n\n      if (values.roastingMenu == \"Single\") {\n        formData.append(\"bean_id\", values.bean);\n      }\n\n      if (values.roastingMenu == \"Blended\") {\n        formData.append(\"beans\", JSON.stringify(values.beans));\n      }\n\n      formData.append(\"roasting_profile_id\", values.roastingProfile);\n      formData.append(\"roasting_name\", values.roastingName);\n      formData.append(\"roastingMenu\", values.roastingMenu);\n      formData.append(\"flavor_note\", values.flavorNote);\n      formData.append(\"acidity\", values.acidity);\n      formData.append(\"intensity\", values.intensity);\n      formData.append(\"weight\", values.weight);\n      formData.append(\"tgl_roasting\", values.tgl_roasting);\n\n      for (let i = 0; i < certificateFile.length; i++) {\n        formData.append(\"certificate[]\", certificateFile[i]);\n      }\n\n      formData.append(\"files_gambar\", filesGambar);\n      formData.append(\"fileName_gambar\", filesGambar.name);\n\n      UserService.addRoastingProduct(formData).then(async (response) => {\n        const roasting_id = response.data.roasting.id;\n        const linkQRCode =\n          process.env.REACT_APP_ROASTER_URL +\n          \"detailRoasting/\" +\n          code +\n          \"/\" +\n          roasting_id;\n        await handleChange(linkQRCode);\n\n        const canvas = document.getElementById(\"myqr\");\n        let imageBlob = await new Promise((resolve) =>\n          canvas.toBlob(resolve, \"image/png\")\n        );\n\n        let formDataQR = new FormData();\n        formDataQR.append(\"files_qr\", imageBlob, \"\" + roasting_id + \".png\");\n        formDataQR.append(\"fileName_qr\", \"\" + roasting_id + \".png\");\n\n        downloadQR(roasting_id);\n\n        UserService.pushQRCodeImageRoasting(roasting_id, formDataQR);\n\n        UserService.getDetailRoastingProduct(roasting_id).then(\n          async (response) => {\n            console.log(response.data);\n            var object = response.data;\n            // formData.forEach(function (value, key) {\n            //   object[key] = value;\n            // });\n            var json = JSON.stringify(object);\n            // console.log(json);\n            console.log(sha256(json));\n            // console.log(contractAddress);\n            console.log(account);\n\n            let date_ob = new Date();\n            let date = (\"0\" + date_ob.getDate()).slice(-2);\n            let month = (\"0\" + (date_ob.getMonth() + 1)).slice(-2);\n            let year = date_ob.getFullYear();\n            let hours = date_ob.getHours();\n            let minutes = date_ob.getMinutes();\n            let seconds = date_ob.getSeconds();\n            console.log(year + \"-\" + month + \"-\" + date);\n\n            //Blockchain Function\n            const storageContract = new web3.eth.Contract(\n              AddProduct,\n              contractAddress\n            );\n            // const gas = await storageContract.methods\n            // .tambahProduct(\n            //   sha256(json),\n            //   year + \"-\" + month + \"-\" + date\n            // )\n            // .estimateGas();\n\n            var post = await storageContract.methods\n              .tambahProduct(sha256(json), year + \"-\" + month + \"-\" + date)\n              .send(\n                {\n                  from: account,\n                  // gas,\n                },\n                (error, transactionHash) => {\n                  console.log(transactionHash);\n                }\n              );\n            console.log(post);\n\n            //Postman Kopi Ketjil\n            var myHeaders = new Headers();\n            myHeaders.append(\"x-api-key\", \"kk-blockchain-2021-dev\");\n\n            var formdata = new FormData();\n            formdata.append(\"category_id\", \"115\");\n            formdata.append(\"name\", values.roastingName);\n            formdata.append(\"description\", json);\n            formdata.append(\"indonesia_price\", \"1000\");\n            formdata.append(\"usd_price\", \"10\");\n            formdata.append(\"aed_price\", \"50\");\n            formdata.append(\"image[]\", filesGambar, \"[PROXY]\");\n\n            var requestOptions = {\n              method: \"POST\",\n              headers: myHeaders,\n              body: formdata,\n              redirect: \"follow\",\n            };\n\n            fetch(\n              \"https://api-staging.kopiketjil.com/api/kopiketjil/insert-product\",\n              requestOptions\n            )\n              .then((response) => response.text())\n              .then((result) => console.log(result))\n              .catch((error) => console.log(\"error\", error));\n          }\n        );\n      });\n\n      showResults(\"Data has been added\");\n    } else {\n      showResults(\"Please fill all the fields\");\n    }\n  };\n\n  return (\n    <Fragment>\n      <AddRoastingForm\n        onSubmit={handleSubmit}\n        onSelectRoasting={onRoastingChange}\n        onSelectImageGambar={onFileChangeGambar}\n      />\n      <div style={{ visibility: \"hidden\" }}>\n        {qr ? (\n          <QRcode id=\"myqr\" value={qr} size={320} includeMargin={true} />\n        ) : (\n          <p>No QR code preview</p>\n        )}\n      </div>\n    </Fragment>\n  );\n};\n\nexport default AddRoasting;\n"]},"metadata":{},"sourceType":"module"}