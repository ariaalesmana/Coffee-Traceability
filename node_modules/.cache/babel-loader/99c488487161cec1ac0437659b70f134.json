{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/blockchain_project/src/components/Grosir/Produk/DaftarProduk.js\",\n    _s = $RefreshSig$();\n\nimport { Fragment, useState, useEffect } from \"react\";\nimport showResults from \"../../showResults/showResults\";\nimport DaftarProdukForm from \"./DaftarProdukForm\";\nimport UserService from \"../../../services/user.service\";\nimport Web3 from \"web3\";\nimport { AddProduct } from \"../../../abi/abi\";\nimport QRcode from \"qrcode.react\";\nimport { sha256 } from \"js-sha256\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nrequire(\"dotenv\").config();\n\nconst HDWalletProvider = require(\"@truffle/hdwallet-provider\");\n\nconst DaftarProduk = props => {\n  _s();\n\n  const provider = new HDWalletProvider(process.env.REACT_APP_MNEMONIC, \"https://ropsten.infura.io/v3/\" + process.env.REACT_APP_INFURA_PROJECT_ID);\n  const web3 = new Web3(provider);\n  provider.engine.stop(); // const contractAddress = \"0xEb8eF83cB027D9d3594b77eCd05051E138741e5B\";\n\n  const contractAddress = \"0x061Bca64852219aA03a9615ef66Dc301e075F6d9\";\n  const code = props.code;\n  const [files, imageFile] = useState(\"\");\n  const [filesGambar, imageFileGambar] = useState(\"\");\n  const [balance, setBalance] = useState(0);\n  const [account, setAccount] = useState(\"\");\n  const [currencyID, setCurrencyID] = useState([]);\n\n  const onFileChange = file => {\n    imageFile(file);\n  };\n\n  const onFileChangeGambar = file => {\n    imageFileGambar(file);\n  };\n\n  const getWallet = async () => {\n    web3.eth.getAccounts(function (err, accounts) {\n      if (err != null) {\n        alert(\"An error occurred: \" + err);\n      } else if (accounts.length == 0) {\n        alert(\"User is not logged in to MetaMask\");\n      } else {\n        setAccount(accounts[0]);\n      }\n    });\n  };\n\n  useEffect(() => {\n    getWallet();\n    getDefaultCurrency();\n  }, []);\n\n  const getDefaultCurrency = () => {\n    UserService.getAddDetailProduct().then(response => {\n      response.data.currencies.map(value => {\n        if (value.code == response.data.defaultCurrencies) {\n          setCurrencyID(value.id);\n        }\n      });\n    });\n  };\n\n  const [qr, setQr] = useState(\"test\");\n\n  const handleChange = value => {\n    setQr(value);\n  };\n\n  const downloadQR = product_id => {\n    const canvas = document.getElementById(\"myqr\");\n    const pngUrl = canvas.toDataURL(\"image/png\").replace(\"image/png\", \"image/octet-stream\");\n    let downloadLink = document.createElement(\"a\");\n    downloadLink.href = pngUrl;\n    downloadLink.download = \"\" + product_id + \".png\";\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n  };\n\n  const handleSubmit = async values => {\n    if (values.roastingMenu && values.batch_id && values.name && values.productGroup && values.category && values.subcategory && values.description && values.short_description && values.price && values.unit && values.stock && values.sku && values.weight && values.tgl_produksi && files != \"\" && filesGambar != \"\") {\n      const formData = new FormData();\n\n      if (values.roastingMenu == \"Single\") {\n        formData.append(\"batch_id\", values.batch_id);\n      }\n\n      if (values.roastingMenu == \"Blended\") {\n        formData.append(\"beans\", JSON.stringify(values.beans));\n      }\n\n      formData.append(\"name\", values.name);\n      formData.append(\"product_group\", values.productGroup);\n      formData.append(\"category\", values.category);\n      formData.append(\"subcategory\", values.subcategory);\n      formData.append(\"description\", values.description);\n      formData.append(\"short_description\", values.short_description);\n      formData.append(\"price\", values.price);\n\n      if (values.currency == undefined) {\n        formData.append(\"currency\", currencyID);\n      } else {\n        formData.append(\"currency\", values.currency);\n      }\n\n      formData.append(\"unit\", values.unit);\n      formData.append(\"stock\", values.stock);\n      formData.append(\"sku\", values.sku); // formData.append(\"vendor_sku\", values.vendor_sku);\n\n      formData.append(\"weight\", values.weight);\n      formData.append(\"tgl_produksi\", values.tgl_produksi);\n\n      for (let i = 0; i < files.length; i++) {\n        formData.append(\"files[]\", files[i]);\n      }\n\n      formData.append(\"files_gambar\", filesGambar);\n      formData.append(\"fileName_gambar\", filesGambar.name);\n      UserService.addProduct(formData).then(async response => {\n        const product_id = response.data.product.id; // const linkQRCode = \"http://127.0.0.1:3000/detailProduk/\" + product_id;\n\n        const linkQRCode = process.env.REACT_APP_PROD_URL + \"detailProduk/\" + code + \"/\" + product_id;\n        await handleChange(linkQRCode);\n        const canvas = document.getElementById(\"myqr\");\n        let imageBlob = await new Promise(resolve => canvas.toBlob(resolve, \"image/png\"));\n        let formDataQR = new FormData();\n        formDataQR.append(\"files_qr\", imageBlob, \"\" + product_id + \".png\");\n        formDataQR.append(\"fileName_qr\", \"\" + product_id + \".png\");\n        downloadQR(product_id);\n        UserService.pushQRCodeImage(product_id, formDataQR);\n        UserService.getDetailProduk(product_id).then(async response => {\n          console.log(response.data);\n          var object = response.data; // formData.forEach(function (value, key) {\n          //   object[key] = value;\n          // });\n\n          var json = JSON.stringify(object); // console.log(json);\n\n          console.log(sha256(json)); // console.log(contractAddress);\n\n          console.log(account);\n          let date_ob = new Date();\n          let date = (\"0\" + date_ob.getDate()).slice(-2);\n          let month = (\"0\" + (date_ob.getMonth() + 1)).slice(-2);\n          let year = date_ob.getFullYear();\n          let hours = date_ob.getHours();\n          let minutes = date_ob.getMinutes();\n          let seconds = date_ob.getSeconds();\n          console.log(year + \"-\" + month + \"-\" + date); //Blockchain Function\n\n          const storageContract = new web3.eth.Contract(AddProduct, contractAddress); // const gas = await storageContract.methods\n          // .tambahProduct(\n          //   sha256(json),\n          //   year + \"-\" + month + \"-\" + date\n          // )\n          // .estimateGas();\n\n          var post = await storageContract.methods.tambahProduct(sha256(json), year + \"-\" + month + \"-\" + date).send({\n            from: account // gas,\n\n          }, (error, transactionHash) => {\n            console.log(transactionHash);\n          });\n          console.log(post); //Postman Kopi Ketjil\n\n          var myHeaders = new Headers();\n          myHeaders.append(\"x-api-key\", \"kk-blockchain-2021-dev\");\n          var formdata = new FormData();\n          formdata.append(\"category_id\", \"115\");\n          formdata.append(\"name\", values.name);\n          formdata.append(\"description\", json);\n          formdata.append(\"indonesia_price\", \"1000\");\n          formdata.append(\"usd_price\", \"10\");\n          formdata.append(\"aed_price\", \"50\");\n          formdata.append(\"image[]\", filesGambar, \"[PROXY]\");\n          var requestOptions = {\n            method: \"POST\",\n            headers: myHeaders,\n            body: formdata,\n            redirect: \"follow\"\n          };\n          fetch(\"https://api-staging.kopiketjil.com/api/kopiketjil/insert-product\", requestOptions).then(response => response.text()).then(result => console.log(result)).catch(error => console.log(\"error\", error));\n        });\n        showResults(\"Data has been added\");\n      });\n    } else {\n      showResults(\"Please fill all the fields\");\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(DaftarProdukForm, {\n      onSubmit: handleSubmit,\n      onSelectImage: onFileChange,\n      onSelectImageGambar: onFileChangeGambar\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        visibility: \"hidden\"\n      },\n      children: qr ? /*#__PURE__*/_jsxDEV(QRcode, {\n        id: \"myqr\",\n        value: qr,\n        size: 320,\n        includeMargin: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"No QR code preview\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 252,\n    columnNumber: 5\n  }, this);\n};\n\n_s(DaftarProduk, \"yMMYtTW0vRTsi1LmHytYc931Gqc=\");\n\n_c = DaftarProduk;\nexport default DaftarProduk;\n\nvar _c;\n\n$RefreshReg$(_c, \"DaftarProduk\");","map":{"version":3,"sources":["/Applications/MAMP/htdocs/blockchain_project/src/components/Grosir/Produk/DaftarProduk.js"],"names":["Fragment","useState","useEffect","showResults","DaftarProdukForm","UserService","Web3","AddProduct","QRcode","sha256","require","config","HDWalletProvider","DaftarProduk","props","provider","process","env","REACT_APP_MNEMONIC","REACT_APP_INFURA_PROJECT_ID","web3","engine","stop","contractAddress","code","files","imageFile","filesGambar","imageFileGambar","balance","setBalance","account","setAccount","currencyID","setCurrencyID","onFileChange","file","onFileChangeGambar","getWallet","eth","getAccounts","err","accounts","alert","length","getDefaultCurrency","getAddDetailProduct","then","response","data","currencies","map","value","defaultCurrencies","id","qr","setQr","handleChange","downloadQR","product_id","canvas","document","getElementById","pngUrl","toDataURL","replace","downloadLink","createElement","href","download","body","appendChild","click","removeChild","handleSubmit","values","roastingMenu","batch_id","name","productGroup","category","subcategory","description","short_description","price","unit","stock","sku","weight","tgl_produksi","formData","FormData","append","JSON","stringify","beans","currency","undefined","i","addProduct","product","linkQRCode","REACT_APP_PROD_URL","imageBlob","Promise","resolve","toBlob","formDataQR","pushQRCodeImage","getDetailProduk","console","log","object","json","date_ob","Date","date","getDate","slice","month","getMonth","year","getFullYear","hours","getHours","minutes","getMinutes","seconds","getSeconds","storageContract","Contract","post","methods","tambahProduct","send","from","error","transactionHash","myHeaders","Headers","formdata","requestOptions","method","headers","redirect","fetch","text","result","catch","visibility"],"mappings":"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","sourcesContent":["import { Fragment, useState, useEffect } from \"react\";\nimport showResults from \"../../showResults/showResults\";\nimport DaftarProdukForm from \"./DaftarProdukForm\";\nimport UserService from \"../../../services/user.service\";\nimport Web3 from \"web3\";\nimport { AddProduct } from \"../../../abi/abi\";\n\nimport QRcode from \"qrcode.react\";\nimport { sha256 } from \"js-sha256\";\n\nrequire(\"dotenv\").config();\n\nconst HDWalletProvider = require(\"@truffle/hdwallet-provider\");\n\nconst DaftarProduk = (props) => {\n  const provider = new HDWalletProvider(\n    process.env.REACT_APP_MNEMONIC,\n    \"https://ropsten.infura.io/v3/\" + process.env.REACT_APP_INFURA_PROJECT_ID\n  );\n  const web3 = new Web3(provider);\n  provider.engine.stop();\n\n  // const contractAddress = \"0xEb8eF83cB027D9d3594b77eCd05051E138741e5B\";\n  const contractAddress = \"0x061Bca64852219aA03a9615ef66Dc301e075F6d9\";\n\n  const code = props.code;\n\n  const [files, imageFile] = useState(\"\");\n  const [filesGambar, imageFileGambar] = useState(\"\");\n  const [balance, setBalance] = useState(0);\n  const [account, setAccount] = useState(\"\");\n\n  const [currencyID, setCurrencyID] = useState([]);\n\n  const onFileChange = (file) => {\n    imageFile(file);\n  };\n\n  const onFileChangeGambar = (file) => {\n    imageFileGambar(file);\n  };\n\n  const getWallet = async () => {\n    web3.eth.getAccounts(function (err, accounts) {\n      if (err != null) {\n        alert(\"An error occurred: \" + err);\n      } else if (accounts.length == 0) {\n        alert(\"User is not logged in to MetaMask\");\n      } else {\n        setAccount(accounts[0]);\n      }\n    });\n  };\n\n  useEffect(() => {\n    getWallet();\n    getDefaultCurrency();\n  }, []);\n\n  const getDefaultCurrency = () => {\n    UserService.getAddDetailProduct().then((response) => {\n      response.data.currencies.map((value) => {\n        if (value.code == response.data.defaultCurrencies) {\n          setCurrencyID(value.id);\n        }\n      });\n    });\n  };\n\n  const [qr, setQr] = useState(\"test\");\n  const handleChange = (value) => {\n    setQr(value);\n  };\n\n  const downloadQR = (product_id) => {\n    const canvas = document.getElementById(\"myqr\");\n    const pngUrl = canvas\n      .toDataURL(\"image/png\")\n      .replace(\"image/png\", \"image/octet-stream\");\n    let downloadLink = document.createElement(\"a\");\n    downloadLink.href = pngUrl;\n    downloadLink.download = \"\" + product_id + \".png\";\n    document.body.appendChild(downloadLink);\n    downloadLink.click();\n    document.body.removeChild(downloadLink);\n  };\n\n  const handleSubmit = async (values) => {\n    if (\n      values.roastingMenu &&\n      values.batch_id &&\n      values.name &&\n      values.productGroup &&\n      values.category &&\n      values.subcategory &&\n      values.description &&\n      values.short_description &&\n      values.price &&\n      values.unit &&\n      values.stock &&\n      values.sku &&\n      values.weight &&\n      values.tgl_produksi &&\n      files != \"\" &&\n      filesGambar != \"\"\n    ) {\n      const formData = new FormData();\n\n      if (values.roastingMenu == \"Single\") {\n        formData.append(\"batch_id\", values.batch_id);\n      }\n\n      if (values.roastingMenu == \"Blended\") {\n        formData.append(\"beans\", JSON.stringify(values.beans));\n      }\n\n      formData.append(\"name\", values.name);\n      formData.append(\"product_group\", values.productGroup);\n      formData.append(\"category\", values.category);\n      formData.append(\"subcategory\", values.subcategory);\n      formData.append(\"description\", values.description);\n      formData.append(\"short_description\", values.short_description);\n      formData.append(\"price\", values.price);\n\n      if (values.currency == undefined) {\n        formData.append(\"currency\", currencyID);\n      } else {\n        formData.append(\"currency\", values.currency);\n      }\n\n      formData.append(\"unit\", values.unit);\n      formData.append(\"stock\", values.stock);\n      formData.append(\"sku\", values.sku);\n      // formData.append(\"vendor_sku\", values.vendor_sku);\n      formData.append(\"weight\", values.weight);\n      formData.append(\"tgl_produksi\", values.tgl_produksi);\n\n      for (let i = 0; i < files.length; i++) {\n        formData.append(\"files[]\", files[i]);\n      }\n\n      formData.append(\"files_gambar\", filesGambar);\n      formData.append(\"fileName_gambar\", filesGambar.name);\n\n      UserService.addProduct(formData).then(async (response) => {\n        const product_id = response.data.product.id;\n        // const linkQRCode = \"http://127.0.0.1:3000/detailProduk/\" + product_id;\n        const linkQRCode =\n          process.env.REACT_APP_PROD_URL +\n          \"detailProduk/\" +\n          code +\n          \"/\" +\n          product_id;\n        await handleChange(linkQRCode);\n\n        const canvas = document.getElementById(\"myqr\");\n        let imageBlob = await new Promise((resolve) =>\n          canvas.toBlob(resolve, \"image/png\")\n        );\n\n        let formDataQR = new FormData();\n        formDataQR.append(\"files_qr\", imageBlob, \"\" + product_id + \".png\");\n        formDataQR.append(\"fileName_qr\", \"\" + product_id + \".png\");\n\n        downloadQR(product_id);\n\n        UserService.pushQRCodeImage(product_id, formDataQR);\n\n        UserService.getDetailProduk(product_id).then(async (response) => {\n          console.log(response.data);\n          var object = response.data;\n          // formData.forEach(function (value, key) {\n          //   object[key] = value;\n          // });\n          var json = JSON.stringify(object);\n          // console.log(json);\n          console.log(sha256(json));\n          // console.log(contractAddress);\n          console.log(account);\n\n          let date_ob = new Date();\n          let date = (\"0\" + date_ob.getDate()).slice(-2);\n          let month = (\"0\" + (date_ob.getMonth() + 1)).slice(-2);\n          let year = date_ob.getFullYear();\n          let hours = date_ob.getHours();\n          let minutes = date_ob.getMinutes();\n          let seconds = date_ob.getSeconds();\n          console.log(year + \"-\" + month + \"-\" + date);\n\n          //Blockchain Function\n          const storageContract = new web3.eth.Contract(\n            AddProduct,\n            contractAddress\n          );\n          // const gas = await storageContract.methods\n          // .tambahProduct(\n          //   sha256(json),\n          //   year + \"-\" + month + \"-\" + date\n          // )\n          // .estimateGas();\n\n          var post = await storageContract.methods\n            .tambahProduct(sha256(json), year + \"-\" + month + \"-\" + date)\n            .send(\n              {\n                from: account,\n                // gas,\n              },\n              (error, transactionHash) => {\n                console.log(transactionHash);\n              }\n            );\n          console.log(post);\n\n          //Postman Kopi Ketjil\n          var myHeaders = new Headers();\n          myHeaders.append(\"x-api-key\", \"kk-blockchain-2021-dev\");\n\n          var formdata = new FormData();\n          formdata.append(\"category_id\", \"115\");\n          formdata.append(\"name\", values.name);\n          formdata.append(\"description\", json);\n          formdata.append(\"indonesia_price\", \"1000\");\n          formdata.append(\"usd_price\", \"10\");\n          formdata.append(\"aed_price\", \"50\");\n          formdata.append(\"image[]\", filesGambar, \"[PROXY]\");\n\n          var requestOptions = {\n            method: \"POST\",\n            headers: myHeaders,\n            body: formdata,\n            redirect: \"follow\",\n          };\n\n          fetch(\n            \"https://api-staging.kopiketjil.com/api/kopiketjil/insert-product\",\n            requestOptions\n          )\n            .then((response) => response.text())\n            .then((result) => console.log(result))\n            .catch((error) => console.log(\"error\", error));\n        });\n\n        showResults(\"Data has been added\");\n      });\n    } else {\n      showResults(\"Please fill all the fields\");\n    }\n  };\n\n  return (\n    <Fragment>\n      <DaftarProdukForm\n        onSubmit={handleSubmit}\n        onSelectImage={onFileChange}\n        onSelectImageGambar={onFileChangeGambar}\n      />\n      <div style={{ visibility: \"hidden\" }}>\n        {qr ? (\n          <QRcode id=\"myqr\" value={qr} size={320} includeMargin={true} />\n        ) : (\n          <p>No QR code preview</p>\n        )}\n      </div>\n    </Fragment>\n  );\n};\nexport default DaftarProduk;\n"]},"metadata":{},"sourceType":"module"}